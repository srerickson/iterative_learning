(function(){"use strict";angular.module("iterativeLearningApp",["ui.router","ngSanitize","schemaForm"]).config(["$stateProvider",function(a){return a.state("task",{url:"/task?key&assignmentId&hitId&workerId&turkSubmitTo",controller:"TaskCtrl",templateUrl:"views/task/task.html",resolve:{task:["$http","$stateParams","ilHost",function(a,b,c){return a.get(c+("/task?key="+b.key+"&workerId="+b.workerId)).then(function(a){return a.data},function(a){return a})}]}})}]).config(["$stateProvider",function(a){return a.state("task.demographics",{url:"/demographics",controller:"TaskDemographicsCtrl",templateUrl:"views/task/demographics.html"})}]).config(["$stateProvider",function(a){return a.state("task.training",{url:"/training",controller:"TaskTrainingCtrl",templateUrl:"views/task/training.html"})}]).config(["$stateProvider",function(a){return a.state("task.testing",{url:"/testing",controller:"TaskTestingCtrl",templateUrl:"views/task/testing.html"})}]).config(["$stateProvider",function(a){return a.state("task.final",{url:"/final",controller:"TaskFinalCtrl",templateUrl:"views/task/final.html"})}]).config(["$stateProvider",function(a){return a.state("task.page",{url:"/page?name",controller:"TaskPageCtrl",templateUrl:"views/task/page.html"}),a.state("experiment",{url:"/experiment?key",controller:"ExperimentCtrl",templateUrl:"views/experiment.html"}),a.state("experiment.results",{url:"/viz?task_key",controller:"ExperimentResultsCtrl",templateUrl:"views/results.html"})}]).constant("ilHost","")}).call(this),function(){"use strict";angular.module("iterativeLearningApp").controller("TaskCtrl",["$scope","$stateParams","$state","$http","$timeout","ilHost","task",function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q;if(h={sequence:["training","testing"],minimum_task_time:0,feedback_delay:1500,pages:{},demographics:{},next_button_help_text:"Adjust the vertical slider and click Next",training_correct_text:"<b>Correct!</b>",training_wrong_text:"<b>Incorrect.</b><br/>Adjust the slider to the correct value (indicated by the yellow bar) and click Next",final_help_text:"Thank you for taking part."},a.config=angular.merge(h,g.config),a.state={name:null,step:0,guess:null,show_feedback:!1,transitioning:!1,task_timer:!1},k={training:[],testing:[]},a.demographics={},a.mturk={submit_action:b.turkSubmitTo+"/mturk/externalSubmit",assignmentId:b.assignmentId},a.submitted=!1,a.task_is_mturk=function(){return!!b.assignmentId},a.mturk_preview=function(){return"ASSIGNMENT_ID_NOT_AVAILABLE"===b.assignmentId},a.mturk_sandbox=function(){return/sandbox/.test(b.turkSubmitTo)},a.task_is_doable=function(){return!!g._start_values&&!!g._start_values.testing&&!!g._start_values.training&&null===g.response_values},a.task_is_complete=function(a){var b;return null==a&&(a=null),b=function(a){var b,c,d,e;try{if(k[a].length!==g._start_values[a].length)return!1;for(e=k[a],c=0,d=e.length;d>c;c++)if(b=e[c],null===b.y)return!1;return!0}catch(f){return!1}},a?b(a):b("testing")&&b("training")},a.start_task_timer=function(){return a.state.task_timer=!0,e(function(){return a.state.task_timer=!1},a.config.minimum_task_time)},a.save_response=function(){var b;return b=k[a.state.name][a.state.step],b.time=(new Date).getTime(),b.y=a.state.guess},a.x=function(){try{return g._start_values[a.state.name][a.state.step].x}catch(b){return null}},a.y=function(){try{return g._start_values[a.state.name][a.state.step].y}catch(b){return null}},a.task_length=function(a){return g._start_values[a].length},a.guess_is_correct=function(b){return null==b&&(b=5),null===a.state.guess?!1:Math.abs(a.state.guess-a.y())<=b},a.status_message=function(){var b;return b=a.state.name,""+b+": step "+(a.state.step+1)+" of "+a.task_length(b)+" "},a.submit=function(){var c;return!a.mturk_preview()&&a.task_is_complete()?(c={task:{response_values:k,demographics:a.demographics}},b.workerId&&(c.task.mturk_worker_id=b.workerId),d.post(f+("/task?key="+b.key),c).then(function(){return a.submitted=c},function(a){return console.log(a)})):void 0},a.next_in_sequence=function(){var b,d;return b=a.config.sequence.indexOf(a.state.name),d=a.config.sequence[b+1],/^(testing|training|demographics)$/.test(d)?c.go("task."+d):void 0!==d?c.go("task.page",{name:d}):c.go("task.final")},a.task_is_doable()){for(p=["testing","training"],l=0,n=p.length;n>l;l++)for(j=p[l],q=g._start_values[j],m=0,o=q.length;o>m;m++)i=q[m],k[j].push({x:i.x,y:null,time:null});return a.next_in_sequence()}}])}.call(this),function(){"use strict";angular.module("iterativeLearningApp").controller("TaskPageCtrl",["$scope","$stateParams",function(a,b){return a.page=a.config.pages[b.name],a.$parent.state.name=b.name}])}.call(this),function(){"use strict";angular.module("iterativeLearningApp").controller("TaskDemographicsCtrl",["$scope","$state","ilHost",function(a){return a.$parent.state.name="demographics",a.schema={type:"object",properties:a.$parent.config.demographics,required:Object.keys(a.$parent.config.demographics)},a.form=["*",{type:"submit",title:"Next"}],a.onSubmit=function(b){return a.$broadcast("schemaFormValidate"),b.$valid?a.next_in_sequence():void 0}}])}.call(this),function(){"use strict";angular.module("iterativeLearningApp").controller("TaskTestingCtrl",["$scope","$state",function(a){return angular.merge(a.$parent.state,{name:"testing",step:0,show_feedback:!1,transitioning:!1,guess:null,task_timer:!1}),a.start_task_timer(),a.next=function(){return null!==a.state.guess?(a.save_response(),a.state.step<a.task_length("testing")-1?(a.state.guess=null,a.state.step+=1,a.start_task_timer()):a.next_in_sequence()):void 0}}])}.call(this),function(){"use strict";angular.module("iterativeLearningApp").controller("TaskTrainingCtrl",["$scope","$state","$timeout",function(a,b,c){return angular.merge(a.$parent.state,{name:"training",step:0,show_feedback:!1,transitioning:!1,guess:null,task_timer:!1}),a.feedback_message=a.config.next_button_help_text,a.next=function(){return null===a.state.guess||a.state.transitioning?void 0:(a.state.show_feedback||a.save_response(),a.state.show_feedback=!0,a.guess_is_correct()?(a.feedback_message=a.config.training_correct_text,a.state.transitioning=!0,c(function(){return a.state.step<a.task_length("training")-1?(a.state.step+=1,a.state.guess=null,a.state.show_feedback=!1,a.state.transitioning=!1,a.feedback_message=a.config.next_button_help_text):a.next_in_sequence()},a.config.feedback_delay),!0):(a.feedback_message=a.config.training_wrong_text,!1))}}])}.call(this),function(){"use strict";angular.module("iterativeLearningApp").controller("TaskFinalCtrl",["$scope","$stateParams","$state","$http","ilHost",function(a){return a.$parent.state.name="final",a.$parent.submit()}])}.call(this),function(){"use strict";angular.module("iterativeLearningApp").controller("ExperimentCtrl",["$scope","$http","$stateParams","ilHost",function(a,b,c,d){return a.experiment={},b.get(d+("/experiment?key="+c.key)).then(function(b){return a.experiment=b.data},function(a){return console.log(a)})}]).controller("ExperimentResultsCtrl",["$scope","$http","$stateParams","ilHost",function(a,b,c,d){return b.get(d+("/task?key="+c.task_key)).then(function(b){return a.task=b.data},function(a){return console.log(a)})}]).directive("ilFunctionPlot",function(){var a;return a=function(a,b){return a.selectAll(".dot.start_vals").data(b._start_values.testing).enter().append("circle").attr("class","dot").attr("class","start_vals").attr("r",2).attr("cx",function(a){return 2*a.x}).attr("cy",function(a){return 2*(100-a.y)}),b.response_values&&b.response_values.testing?a.selectAll(".dot.response_vals").data(b.response_values.testing).enter().append("circle").attr("class","dot").attr("class","response_vals").attr("r",2).attr("cx",function(a){return 2*a.x}).attr("cy",function(a){return 2*(100-a.y)}).attr("fill","#F00"):void 0},{link:function(b,c){var d;return d=d3.select(c[0]).append("svg"),b.$watch("task",function(b){return b?a(d,b):void 0})},scope:{task:"="}}})}.call(this),function(){"use strict";angular.module("iterativeLearningApp").directive("ilSlider",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e,f;return f={orientation:"vertical",range:"min",min:1,max:100},e=function(){return angular.extend(f,a.$eval(c.ilSlider)||{}),b.slider(f),e=angular.noop},b.bind("slide",function(b,c){return d.$setViewValue(c.value),a.$apply()}),d.$render=function(){return e(),b.slider("value",d.$viewValue)}}}})}.call(this),function(){"use strict";angular.module("iterativeLearningApp").directive("ilTaskTimer",function(){return{template:'<svg><path id="border"/><path id="loader"/></svg>',restrict:"A",scope:{ilTaskTimer:"=",time:"="},link:function(a,b){var c,d,e,f,g,h;return g=b.find("svg"),e=b.find("#loader"),c=b.find("#border"),d=b.height(),h=b.width(),g.attr("width",h),g.attr("height",d),g.attr("viewbox","0 0 "+h+" "+d),c.attr("transform","translate("+h/2+","+d/2+")"),e.attr("transform","translate("+h/2+","+d/2+") scale(.84)"),a.$watch("ilTaskTimer",function(a){return a?f():void 0}),f=function(){var b,f,g,i;return g=0,i=Math.PI,f=33,(b=function(){var j,k,l,m,n,o;return m=a.time||0,g+=360*f/m,g>360?void 0:(l=g*i/180,n=Math.sin(l)*h/2,o=-1*Math.cos(l)*d/2,k=g>180?1:0,j="M 0 0 v -"+h/2+" A "+h/2+" "+d/2+" 1 "+k+" 1 "+n+" "+o+" z",c.attr("d",j),e.attr("d",j),setTimeout(b,f))})()}}}})}.call(this);